{% extends "admin_side/index.html" %}
{% block content %}

<div class="container-fluid py-4">
    <h2 class="fw-bold text-center text-primary mb-4">
        <i class="bi bi-building"></i> All Properties
    </h2>

    <div class="row g-4">
        {% for prop in properties %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm border-0 rounded-3">
                <!-- Property Image -->
                {% if prop.property_photos %}
                    {% set photo = prop.property_photos.split(',')[0].strip() %}
                    <img src="{{ url_for('static', filename=photo.replace('static/', '')) }}" 
                         class="card-img-top rounded-top" 
                         alt="Property Image" 
                         style="height: 200px; object-fit: cover;">
                {% else %}
                    <img src="https://via.placeholder.com/400x200?text=No+Image" 
                         class="card-img-top rounded-top" 
                         alt="No Image">
                {% endif %}

                <!-- Card Body -->
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title fw-bold text-dark">
                        {{ prop.property_name }}
                    </h5>
                    <p class="text-muted small mb-2">
                        <i class="bi bi-geo-alt-fill text-danger"></i> 
                        {{ prop.city }}, {{ prop.state }}, {{ prop.country }}
                    </p>

                    <p class="mb-1"><strong>Code:</strong> {{ prop.prop_code }}</p>
                    <p class="mb-1"><strong>Type:</strong> {{ prop.property_type }}</p>
                    <p class="mb-1"><strong>Size:</strong> {{ prop.property_size }} sq.ft</p>
                    <p class="mb-1"><strong>Capacity:</strong> {{ prop.guest_capacity }} Guests</p>
                    <p class="mb-1"><strong>Bedrooms:</strong> {{ prop.bedroom_count }} | 
                        <strong>Bathrooms:</strong> {{ prop.bathroom_count }}
                    </p>
                    <p class="mb-1"><strong>Status:</strong> 
                        <span class="badge {% if prop.status == 'Approved' %}bg-success{% elif prop.status == 'Pending' %}bg-warning text-dark{% else %}bg-danger{% endif %}">
                            {{ prop.status }}
                        </span>
                    </p>
                    <p class="mb-1"><strong>Posted On:</strong> 
                        {{ prop.created_at.strftime('%d %b %Y') if prop.created_at else today_date }}
                    </p>

                    <!-- Short description (trimmed) -->
                    <p class="text-truncate-2 small text-muted mt-2">
                        {{ prop.short_description }}
                    </p>

                    <div class="mt-auto">
                        <a href="{{ url_for('admin_view_property_details', property_id=prop.id) }}" 
                           class="btn btn-primary w-100 mt-3">
                            <i class="bi bi-eye-fill"></i> View
                        </a>
                    </div>
                </div>

                <!-- Card Footer with Owner Info -->
                <div class="card-footer bg-light small text-muted">
                    <i class="bi bi-person-circle"></i> {{ prop.owner.name }} | 
                    <i class="bi bi-envelope"></i> {{ prop.owner.email }}
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12">
            <div class="alert alert-warning text-center">
                <i class="bi bi-exclamation-triangle-fill"></i> No properties found.
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Custom style for truncating description -->
<style>
.text-truncate-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2; /* limit to 2 lines */
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>

{% endblock %}
