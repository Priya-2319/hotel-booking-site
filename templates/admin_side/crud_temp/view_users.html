{% extends 'admin_side/index.html' %}
{% block title %}
    Users List - LuxStay Admin
{% endblock %}

{% block content %}
<div class="admin-users-container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="header-content">
            <h1><i class="fas fa-users"></i> Users Management</h1>
            <p>Manage all registered users on LuxStay platform</p>
        </div>
        <div class="header-date">
            <span class="date-badge"><i class="fas fa-calendar-alt"></i> {{ today_date }}</span>
        </div>
    </div>

    <!-- Stats Overview -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-icon total-users">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-info">
                <h3>{{ users|length }}</h3>
                <p>Total Users</p>
            </div>
        </div>
    </div>

    <!-- Search Section -->
    <div class="table-controls">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="userSearch" placeholder="Search users by name, email or phone...">
        </div>
    </div>

    <!-- Users Table -->
    <div class="table-container">
        <table class="users-table">
            <thead>
                <tr>
                    <th>S.No.</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>DOB</th>
                    <th>Address</th>
                    <th>Joined Since</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="userTableBody">
                {% for user in users %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>
                        <div class="user-info">
                            <div class="user-avatar">{{ user.name[0]|upper }}</div>
                            <div class="user-details">
                                <span class="user-name">{{ user.name }}</span>
                                <span class="user-id">ID: USER{{ user.id }}</span>
                            </div>
                        </div>
                    </td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.phone }}</td>
                    <td>{{ user.dob }}</td>
                    <td>
                        {% if user.address %}
                        <div class="address-cell">
                            {{ user.address[:30] }}{% if user.address|length > 30 %}...{% endif %}
                            {% if user.address|length > 30 %}
                            <div class="tooltip">{{ user.address }}</div>
                            {% endif %}
                        </div>
                        {% else %}
                        N/A
                        {% endif %}
                    </td>
                    <td>{{ user.created_at.strftime('%Y-%m-%d') }}</td>
                    <td>
                        <div class="action-buttons">
                            <a href="{{ url_for('admin_view_user_details', user_id=user.id) }}" class="btn-view" title="View Details">
                                <i class="fas fa-eye"></i>
                            </a>
                            <!-- suspend user or activate user -->
                            {% if user.status == 'Active' %}
                            <a href="{{ url_for('admin_suspended_user', user_id=user.id) }}" class="btn-suspend" title="Suspend User">
                                <i class="fas fa-user-slash"></i>
                            </a>
                            {% else %}
                            <a href="{{ url_for('admin_activate_user', user_id=user.id) }}" class="btn-activate" title="Activate User">
                                <i class="fas fa-user-check"></i>
                            </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div class="pagination-container">
        <div class="pagination-info" id="paginationInfo">Showing 1 to 10 of {{ users|length }} entries</div>
        <div class="pagination-controls" id="paginationControls"></div>
    </div>

    <!-- Back to Dashboard -->
    <div class="action-buttons-container">
        <a href="{{ url_for('admin_dashboard') }}" class="btn-back-dashboard">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>
</div>

<!-- Include FontAwesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<script>
    const rowsPerPage = 10;
    let currentPage = 1;
    const tableBody = document.getElementById('userTableBody');
    const rows = Array.from(tableBody.querySelectorAll('tr'));
    const paginationInfo = document.getElementById('paginationInfo');
    const paginationControls = document.getElementById('paginationControls');
    const searchInput = document.getElementById('userSearch');

    function renderTable() {
        const searchValue = searchInput.value.toLowerCase();
        const filteredRows = rows.filter(row => row.textContent.toLowerCase().includes(searchValue));
        const totalRows = filteredRows.length;
        const totalPages = Math.ceil(totalRows / rowsPerPage);

        if (currentPage > totalPages) currentPage = totalPages || 1;

        const start = (currentPage - 1) * rowsPerPage;
        const end = start + rowsPerPage;

        rows.forEach(row => row.style.display = 'none');
        filteredRows.slice(start, end).forEach(row => row.style.display = '');

        paginationInfo.textContent = `Showing ${start + 1} to ${Math.min(end, totalRows)} of ${totalRows} entries`;

        renderPagination(totalPages);
    }

    function renderPagination(totalPages) {
        paginationControls.innerHTML = '';

        const prevBtn = document.createElement('button');
        prevBtn.className = 'pagination-btn';
        prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
        prevBtn.disabled = currentPage === 1;
        prevBtn.classList.toggle('disabled', currentPage === 1);
        prevBtn.addEventListener('click', () => { currentPage--; renderTable(); });
        paginationControls.appendChild(prevBtn);

        for (let i = 1; i <= totalPages; i++) {
            const btn = document.createElement('button');
            btn.className = 'pagination-btn';
            if (i === currentPage) btn.classList.add('active');
            btn.textContent = i;
            btn.addEventListener('click', () => { currentPage = i; renderTable(); });
            paginationControls.appendChild(btn);
        }

        const nextBtn = document.createElement('button');
        nextBtn.className = 'pagination-btn';
        nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
        nextBtn.disabled = currentPage === totalPages;
        nextBtn.classList.toggle('disabled', currentPage === totalPages);
        nextBtn.addEventListener('click', () => { currentPage++; renderTable(); });
        paginationControls.appendChild(nextBtn);
    }

    searchInput.addEventListener('input', () => {
        currentPage = 1;
        renderTable();
    });

    // Initial render
    renderTable();
</script>

<style>
    /* Base Styles */
    .admin-users-container {
        padding: 20px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f7fa;
        min-height: 100vh;
    }
    
    /* Page Header */
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px 25px;
        border-radius: 12px;
        color: white;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    .header-content h1 {
        margin: 0 0 5px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .header-content p {
        margin: 0;
        opacity: 0.9;
    }
    
    .date-badge {
        background: rgba(255, 255, 255, 0.2);
        padding: 8px 15px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
    }
    
    /* Stats Cards */
    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        display: flex;
        align-items: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.04);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }
    
    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-size: 24px;
        color: white;
    }
    
    .stat-icon.total-users {
        background: linear-gradient(45deg, #4299e1, #3182ce);
    }
    
    .stat-icon.new-users {
        background: linear-gradient(45deg, #48bb78, #38a169);
    }
    
    .stat-icon.active-users {
        background: linear-gradient(45deg, #ed8936, #dd6b20);
    }
    
    .stat-info h3 {
        margin: 0;
        font-size: 1.8rem;
        font-weight: 700;
        color: #2d3748;
    }
    
    .stat-info p {
        margin: 5px 0 0;
        color: #718096;
        font-size: 0.9rem;
    }
    
    /* Table Controls */
    .table-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .search-box {
        position: relative;
        flex-grow: 1;
        max-width: 500px;
    }
    
    .search-box i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #a0aec0;
    }
    
    .search-box input {
        width: 100%;
        padding: 12px 15px 12px 45px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    .search-box input:focus {
        outline: none;
        border-color: #4299e1;
        box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
    }
    
    .filter-options {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .filter-options select {
        padding: 12px 15px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        background: white;
        cursor: pointer;
    }
    
    .btn-export {
        background: linear-gradient(45deg, #48bb78, #38a169);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: opacity 0.3s ease;
    }
    
    .btn-export:hover {
        opacity: 0.9;
    }
    
    /* Users Table */
    .table-container {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.04);
        margin-bottom: 20px;
        overflow-x: auto;
    }
    
    .users-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 1000px;
    }
    
    .users-table th {
        background-color: #f8fafc;
        padding: 15px;
        text-align: left;
        font-weight: 600;
        color: #4a5568;
        border-bottom: 2px solid #e2e8f0;
    }
    
    .users-table td {
        padding: 15px;
        border-bottom: 1px solid #e2e8f0;
        color: #4a5568;
    }
    
    .users-table tr:last-child td {
        border-bottom: none;
    }
    
    .users-table tr:hover {
        background-color: #f7fafc;
    }
    
    .sortable {
        cursor: pointer;
        user-select: none;
    }
    
    .sortable:hover {
        color: #4299e1;
    }
    
    /* User Info Cell */
    .user-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(45deg, #4299e1, #3182ce);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 1rem;
    }
    
    .user-details {
        display: flex;
        flex-direction: column;
    }
    
    .user-name {
        font-weight: 600;
        color: #2d3748;
    }
    
    .user-id {
        font-size: 0.8rem;
        color: #718096;
    }
    
    /* Address Cell */
    .address-cell {
        position: relative;
        cursor: pointer;
    }
    
    .address-cell:hover .tooltip {
        visibility: visible;
        opacity: 1;
    }
    
    .tooltip {
        visibility: hidden;
        opacity: 0;
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: #2d3748;
        color: white;
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 0.8rem;
        white-space: nowrap;
        transition: all 0.3s ease;
        margin-bottom: 5px;
        z-index: 10;
    }
    
    .tooltip::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border-width: 5px;
        border-style: solid;
        border-color: #2d3748 transparent transparent transparent;
    }
    
    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 8px;
    }
    
    .action-buttons button {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .btn-view {
        background: #e6fffa;
        color: #319795;
    }
    
    .btn-view:hover {
        background: #319795;
        color: white;
    }
    
    .btn-edit {
        background: #ebf8ff;
        color: #3182ce;
    }
    
    .btn-edit:hover {
        background: #3182ce;
        color: white;
    }
    
    .btn-delete {
        background: #fff5f5;
        color: #e53e3e;
    }
    
    .btn-delete:hover {
        background: #e53e3e;
        color: white;
    }
    
    /* Pagination */
    .pagination-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }
    
    .pagination-info {
        color: #718096;
        font-size: 0.9rem;
    }
    
    .pagination-controls {
        display: flex;
        gap: 8px;
    }
    
    .pagination-btn {
        padding: 8px 12px;
        border: 1px solid #e2e8f0;
        background: white;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 36px;
    }
    
    .pagination-btn:hover:not(.disabled):not(.active) {
        border-color: #4299e1;
        color: #4299e1;
    }
    
    .pagination-btn.active {
        background: #4299e1;
        color: white;
        border-color: #4299e1;
    }
    
    .pagination-btn.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    /* Back to Dashboard Button */
    .action-buttons-container {
        text-align: center;
    }
    
    .btn-back-dashboard {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        text-decoration: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-back-dashboard:hover {
        opacity: 0.9;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
        .stats-cards {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (max-width: 768px) {
        .admin-users-container {
            padding: 15px;
        }
        
        .page-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
        }
        
        .table-controls {
            flex-direction: column;
            align-items: stretch;
        }
        
        .filter-options {
            flex-direction: column;
            align-items: stretch;
        }
        
        .stats-cards {
            grid-template-columns: 1fr;
        }
        
        .pagination-container {
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }
    }
    
    @media (max-width: 480px) {
        .header-content h1 {
            font-size: 1.5rem;
        }
        
        .stat-card {
            flex-direction: column;
            text-align: center;
        }
        
        .stat-icon {
            margin-right: 0;
            margin-bottom: 15px;
        }
        
        .action-buttons {
            flex-wrap: wrap;
        }
    }
</style>
{% endblock %}