{% extends 'owner_side/index.html' %}
{% block title %}{{ property.property_name }}{% endblock %}

{% block content %}
<div class="property-view-container">
    <!-- Hero Section -->
    <div class="property-hero" style="background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('/{{ property.property_photos.split(',')[0].strip() if property.property_photos else '/static/images/property-default.jpg' }}');">
        <div class="container">
            <div class="hero-content text-center text-white">
                <h1 class="hero-title">{{ property.property_name }}</h1>
                <p class="hero-subtitle">{{ property.city }}, {{ property.country }}</p>
                <div class="hero-badge">
                    <span class="badge bg-primary">{{ property.property_type|title }}</span>
                    <span class="badge bg-success">{{ property.guest_capacity }} Guests</span>
                    <span class="badge bg-info">{{ property.bedroom_count }} Bedrooms</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container py-5">
        <!-- Property Gallery -->
        <section class="property-gallery mb-5">
            <div id="propertyCarousel" class="carousel slide shadow-lg" data-bs-ride="carousel">
                <div class="carousel-inner rounded-4">
                    {% for photo in property.property_photos.split(',') %}
                    <div class="carousel-item {% if loop.first %}active{% endif %}">
                        <div class="carousel-image" style="background-image: url('/{{ photo.strip() }}');"></div>
                    </div>
                    {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#propertyCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#propertyCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </section>

        <!-- Property Details -->
        <div class="row g-4">
            <!-- Main Details -->
            <div class="col-lg-8">
                <div class="property-card">
                    <div class="card-header">
                        <h2><i class="fas fa-info-circle me-2"></i>Property Details</h2>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <i class="fas fa-tag"></i>
                                    <div>
                                        <h5>Property Code</h5>
                                        <p>{{ property.prop_code }}</p>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-home"></i>
                                    <div>
                                        <h5>Type</h5>
                                        <p>{{ property.property_type|title }}</p>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-users"></i>
                                    <div>
                                        <h5>Guest Capacity</h5>
                                        <p>{{ property.guest_capacity }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="detail-item">
                                    <i class="fas fa-bed"></i>
                                    <div>
                                        <h5>Bedrooms</h5>
                                        <p>{{ property.bedroom_count }}</p>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-bath"></i>
                                    <div>
                                        <h5>Bathrooms</h5>
                                        <p>{{ property.bathroom_count }}</p>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <i class="fas fa-ruler-combined"></i>
                                    <div>
                                        <h5>Size</h5>
                                        <p>{{ property.property_size }} sq ft</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="description-section">
                            <h3><i class="fas fa-align-left me-2"></i>Description</h3>
                            <p>{{ property.full_description }}</p>
                        </div>

                        <div class="location-section">
                            <h3><i class="fas fa-map-marker-alt me-2"></i>Location</h3>
                            <p>{{ property.street_address }}, {{ property.city }}, {{ property.state }} {{ property.zip_code }}, {{ property.country }}</p>
                            {% if property.nearby %}
                            <div class="nearby-attractions">
                                <h4>Nearby Attractions</h4>
                                <p>{{ property.nearby }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Amenities Card -->
                <div class="property-card amenities-card">
                    <div class="card-header">
                        <h2><i class="fas fa-star me-2"></i>Amenities</h2>
                    </div>
                    <div class="card-body">
                        <div class="amenities-grid">
                            {% for amenity in property.amenities.split(',') %}
                            <div class="amenity-item">
                                <i class="fas fa-check"></i>
                                <span>{{ amenity.strip() }}</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% if property.additional_amenities %}
                        <div class="additional-amenities">
                            <h4>Additional Amenities</h4>
                            <p>{{ property.additional_amenities }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Owner Card -->
                <div class="property-card owner-card">
                    <div class="card-header">
                        <h2><i class="fas fa-user-tie me-2"></i>Property Owner</h2>
                    </div>
                    <div class="card-body">
                        <div class="owner-profile">
                            <img src="{{ url_for('static', filename='images/owner-avatar.avif') }}" alt="Owner" class="owner-avatar">
                            <div class="owner-info">
                                <h3>{{ property.owner.name }}</h3>
                                <p><i class="fas fa-envelope"></i> {{ property.owner.email }}</p>
                                <p><i class="fas fa-phone"></i> {{ property.owner.phone }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rooms Section -->
        <section class="rooms-section mt-5">
            <div class="section-header">
                <h2><i class="fas fa-door-open me-2"></i>Rooms</h2>
                <a href="{{ url_for('add_room', property_id=property.id) }}" class="btn btn-primary btn-gradient">
                    <i class="fas fa-plus me-2"></i>Add Room
                </a>
            </div>

            {% if property.rooms %}
            <div class="rooms-grid">
                {% for room in property.rooms %}
                <div class="room-card">
                    <div class="room-image" style="background-image: url('/{{ room.image_url.split(',')[0].strip() if room.image_url else 'static/images/room-default.jpg' }}');">
                        <div class="room-badge {% if room.is_available %}available{% else %}unavailable{% endif %}">
                            {{ 'Available' if room.is_available else 'Booked' }}
                        </div>
                    </div>
                    <div class="room-details">
                        <h3>{{ room.room_type|title }} - #{{ room.room_number }}</h3>
                        <div class="room-info">
                            <p><i class="fas fa-user-friends"></i> {{ room.capacity }} guests</p>
                            <p><i class="fas fa-bed"></i> {{ room.bed_type|capitalize }} bed</p>
                            <p><i class="fas fa-expand"></i> {{ room.room_size }} sq ft</p>
                        </div>
                        <div class="room-price">
                            <span>â‚¹{{ room.price_per_night }}</span> / night
                        </div>
                        <div class="room-actions">
                            <a href="{{ url_for('view_room', room_id=room.id) }}" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-eye"></i> View
                            </a>
                            <a href="{{ url_for('edit_room', property_id=property.id, room_id=room.id) }}" class="btn btn-sm btn-outline-secondary">
                                <i class="fas fa-edit"></i> Edit
                            </a>
                            <a href="{{ url_for('delete_room', room_id=room.id, property_id=property.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure?')">
                                <i class="fas fa-trash"></i> Delete
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="no-rooms">
                <i class="fas fa-door-closed"></i>
                <p>No rooms have been added to this property yet.</p>
                <a href="{{ url_for('add_room', property_id=property.id) }}" class="btn btn-primary btn-gradient">
                    <i class="fas fa-plus me-2"></i>Add Your First Room
                </a>
            </div>
            {% endif %}
        </section>
    </div>
</div>

<style>
    /* Base Styles */
    .property-view-container {
        font-family: 'Poppins', sans-serif;
        color: #333;
    }

    /* Hero Section */
    .property-hero {
        height: 60vh;
        min-height: 400px;
        background-size: cover !important;
        background-position: center !important;
        display: flex;
        align-items: center;
        position: relative;
    }

    .hero-content {
        position: relative;
        z-index: 2;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .hero-title {
        font-size: 3.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .hero-subtitle {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        opacity: 0.9;
    }

    .hero-badge .badge {
        font-size: 1rem;
        padding: 8px 15px;
        margin: 0 5px;
        border-radius: 20px;
    }

    /* Property Card */
    .property-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        margin-bottom: 25px;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .property-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    .card-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
    }

    .card-header h2 {
        font-size: 1.5rem;
        margin: 0;
        display: flex;
        align-items: center;
    }

    .card-header i {
        margin-right: 10px;
    }

    .card-body {
        padding: 25px;
    }

    /* Detail Items */
    .detail-item {
        display: flex;
        margin-bottom: 20px;
    }

    .detail-item i {
        font-size: 1.5rem;
        color: #764ba2;
        margin-right: 15px;
        width: 40px;
        height: 40px;
        background: rgba(118, 75, 162, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .detail-item h5 {
        font-size: 1rem;
        color: #666;
        margin-bottom: 5px;
    }

    .detail-item p {
        font-size: 1.1rem;
        font-weight: 500;
        margin: 0;
    }

    /* Description Section */
    .description-section {
        margin: 30px 0;
        padding: 20px 0;
        border-top: 1px solid #eee;
        border-bottom: 1px solid #eee;
    }

    .description-section h3 {
        font-size: 1.3rem;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
    }

    /* Location Section */
    .location-section h3 {
        font-size: 1.3rem;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
    }

    .nearby-attractions {
        margin-top: 20px;
        padding: 15px;
        background: #f9f9f9;
        border-radius: 8px;
    }

    .nearby-attractions h4 {
        font-size: 1.1rem;
        margin-bottom: 10px;
    }

    /* Amenities */
    .amenities-card .card-body {
        padding-bottom: 15px;
    }

    .amenities-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
    }

    .amenity-item {
        display: flex;
        align-items: center;
        padding: 8px 12px;
        background: rgba(118, 75, 162, 0.05);
        border-radius: 6px;
    }

    .amenity-item i {
        color: #764ba2;
        margin-right: 8px;
        font-size: 0.9rem;
    }

    .amenity-item span {
        font-size: 0.95rem;
    }

    .additional-amenities {
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid #eee;
    }

    /* Owner Card */
    .owner-card .card-body {
        padding-bottom: 15px;
    }

    .owner-profile {
        text-align: center;
    }

    .owner-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #764ba2;
        margin-bottom: 15px;
    }

    .owner-info h3 {
        font-size: 1.3rem;
        margin-bottom: 10px;
    }

    .owner-info p {
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .owner-info i {
        margin-right: 8px;
        color: #764ba2;
    }

    /* Rooms Section */
    .rooms-section {
        margin-top: 50px;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }

    .section-header h2 {
        font-size: 1.8rem;
        margin: 0;
        display: flex;
        align-items: center;
    }

    .btn-gradient {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        transition: all 0.3s ease;
    }

    .btn-gradient:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(118, 75, 162, 0.3);
    }

    /* Rooms Grid */
    .rooms-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 25px;
    }

    .room-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
    }

    .room-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    .room-image {
        height: 200px;
        background-size: cover;
        background-position: center;
        position: relative;
    }

    .room-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
    }

    .room-badge.available {
        background: rgba(40, 167, 70, 0.92);
        color: #ffffff;
    }

    .room-badge.unavailable {
        background: rgba(220, 53, 70, 0.813);
        color: #fefafb;
    }

    .room-details {
        padding: 20px;
    }

    .room-details h3 {
        font-size: 1.3rem;
        margin-bottom: 10px;
    }

    .room-info {
        margin-bottom: 15px;
    }

    .room-info p {
        margin-bottom: 5px;
        display: flex;
        align-items: center;
    }

    .room-info i {
        margin-right: 8px;
        color: #764ba2;
        width: 20px;
        text-align: center;
    }

    .room-price {
        font-size: 1.2rem;
        font-weight: 600;
        color: #764ba2;
        margin-bottom: 15px;
    }

    .room-price span {
        font-size: 1.5rem;
    }

    .room-actions {
        display: flex;
        gap: 10px;
    }

    .room-actions .btn {
        flex: 1;
    }

    /* No Rooms */
    .no-rooms {
        text-align: center;
        padding: 50px;
        background: #f9f9f9;
        border-radius: 12px;
    }

    .no-rooms i {
        font-size: 3rem;
        color: #764ba2;
        margin-bottom: 20px;
    }

    .no-rooms p {
        font-size: 1.1rem;
        margin-bottom: 20px;
    }

    /* Carousel */
    .carousel {
        border-radius: 12px;
        overflow: hidden;
    }

    .carousel-inner {
        border-radius: 12px;
    }

    .carousel-image {
        height: 500px;
        background-size: cover;
        background-position: center;
    }

    .carousel-control-prev, .carousel-control-next {
        width: 50px;
    }

    .carousel-control-prev-icon, .carousel-control-next-icon {
        background-color: rgba(0,0,0,0.5);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        background-size: 60%;
    }

    /* Responsive Adjustments */
    @media (max-width: 992px) {
        .hero-title {
            font-size: 2.8rem;
        }
        
        .carousel-image {
            height: 400px;
        }
    }

    @media (max-width: 768px) {
        .hero-title {
            font-size: 2.2rem;
        }
        
        .hero-subtitle {
            font-size: 1.2rem;
        }
        
        .section-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
        }
        
        .carousel-image {
            height: 300px;
        }
    }

    @media (max-width: 576px) {
        .hero-title {
            font-size: 1.8rem;
        }
        
        .hero-badge .badge {
            font-size: 0.8rem;
            padding: 5px 10px;
            margin: 0 3px;
        }
        
        .amenities-grid {
            grid-template-columns: 1fr 1fr;
        }
        
        .rooms-grid {
            grid-template-columns: 1fr;
        }
        
        .carousel-image {
            height: 250px;
        }
    }
</style>

<script>
    // Initialize carousel
    document.addEventListener('DOMContentLoaded', function() {
        // Activate carousel
        var carousel = new bootstrap.Carousel(document.getElementById('propertyCarousel'), {
            interval: 5000,
            ride: 'carousel'
        });
        
        // Animate elements on scroll
        const animateOnScroll = () => {
            document.querySelectorAll('.property-card, .room-card').forEach(el => {
                const top = el.getBoundingClientRect().top;
                if (top < window.innerHeight * 0.85) {
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }
            });
        };
        
        // Initialize elements as invisible
        document.querySelectorAll('.property-card, .room-card').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(20px)';
            el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        });
        
        animateOnScroll();
        window.addEventListener('scroll', animateOnScroll);
    });
</script>
{% endblock %}