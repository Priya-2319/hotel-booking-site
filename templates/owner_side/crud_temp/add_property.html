{% extends 'owner_side/index.html' %}
{% block title %}Add New Property{% endblock %}

{% block content %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
    $(document).ready(function () {
        $('#country').select2({
            placeholder: "Select country",
            allowClear: true
        });
    });
</script>
<!-- Add Property Header -->
<div class="add-property-header bg-light py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="fw-bold mb-3 animate__animated animate__fadeInDown">Add New Property</h1>
                <nav aria-label="breadcrumb" class="animate__animated animate__fadeIn animate__delay-1s">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{ url_for('owner_dashboard') }}">Dashboard</a></li>
                        <li class="breadcrumb-item"><a href="{{ url_for('owner_properties') }}">Properties</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Add New</li>
                    </ol>
                </nav>
            </div>
            <div class="col-md-4 text-md-end animate__animated animate__fadeIn">
                <a href="{{ url_for('owner_properties') }}" class="btn btn-outline-secondary px-4 py-2">
                    <i class="fas fa-arrow-left me-2"></i> Back to Properties
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Multi-step Form -->
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <ul class="nav nav-pills nav-fill flex-nowrap" id="propertyFormTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="basic-tab" data-bs-toggle="pill" data-bs-target="#basic"
                                type="button" role="tab">
                                <span class="step-number">1</span>
                                Basic Info
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="details-tab" data-bs-toggle="pill" data-bs-target="#details"
                                type="button" role="tab">
                                <span class="step-number">2</span>
                                Details
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="amenities-tab" data-bs-toggle="pill"
                                data-bs-target="#amenities" type="button" role="tab">
                                <span class="step-number">3</span>
                                Amenities
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="photos-tab" data-bs-toggle="pill" data-bs-target="#photos"
                                type="button" role="tab">
                                <span class="step-number">4</span>
                                Photos
                            </button>
                        </li>
                    </ul>
                </div>

                <div class="card-body p-4 p-md-5">
                    <form id="addPropertyForm" action="{{ url_for('add_property') }}" method="POST"
                        enctype="multipart/form-data">
                        <div class="tab-content" id="propertyFormTabsContent">
                            <!-- Step 1: Basic Info -->
                            <div class="tab-pane fade show active" id="basic" role="tabpanel"
                                aria-labelledby="basic-tab">
                                <h4 class="mb-4 fw-bold">Basic Information</h4>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="propertyName"
                                                name="property_name" placeholder="Property Name" required>
                                            <label for="propertyName">Property Name*</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <select class="form-select" id="propertyType" name="property_type" required>
                                                <option value="" selected disabled>Select property type</option>
                                                <option value="apartment">Apartment</option>
                                                <option value="house">House</option>
                                                <option value="villa">Villa</option>
                                                <option value="hotel">Hotel</option>
                                                <option value="resort">Resort</option>
                                                <option value="cabin">Cabin</option>
                                                <option value="other">Other</option>
                                            </select>
                                            <label for="propertyType">Property Type*</label>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-floating">
                                            <textarea class="form-control" placeholder="Short description"
                                                id="shortDescription" name="short_description" style="height: 100px"
                                                required></textarea>
                                            <label for="shortDescription">Short Description*</label>
                                            <small class="text-muted">A brief overview of your property (max 200
                                                characters)</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="number" class="form-control" id="guestCapacity"
                                                name="guest_capacity" placeholder="Guest Capacity" min="1" required>
                                            <label for="guestCapacity">Guest Capacity*</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="number" class="form-control" id="bedroomCount"
                                                name="bedroom_count" placeholder="Bedrooms" min="0" required>
                                            <label for="bedroomCount">Bedrooms*</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="number" class="form-control" id="bathroomCount"
                                                name="bathroom_count" placeholder="Bathrooms" min="0" required>
                                            <label for="bathroomCount">Bathrooms*</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="number" class="form-control" id="propertySize"
                                                name="property_size" placeholder="Property Size" min="0">
                                            <label for="propertySize">Property Size (sq ft)</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between mt-4">
                                    <button type="button" class="btn btn-secondary disabled">Previous</button>
                                    <button type="button" class="btn btn-primary next-step" data-next="details">Next:
                                        Details</button>
                                </div>
                            </div>

                            <!-- Step 2: Details -->
                            <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
                                <h4 class="mb-4 fw-bold">Property Details</h4>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="streetAddress"
                                                name="street_address" placeholder="Street Address" required>
                                            <label for="streetAddress">Street Address*</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="city" name="city"
                                                placeholder="City" required>
                                            <label for="city">City*</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="state" name="state"
                                                placeholder="State/Region" required>
                                            <label for="state">State/Region*</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="zipCode" name="zip_code"
                                                placeholder="ZIP/Postal Code" required>
                                            <label for="zipCode">ZIP/Postal Code*</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="country" class="form-label">Country*</label>
                                        <select class="form-select select2" id="country" name="country" required>
                                            <option value="" selected disabled>Select country</option>
                                            {% for code, name in countries %}
                                            <option value="{{ code }}">{{ name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="nearby" name="nearby"
                                                placeholder="Nearby">
                                            <label for="nearby">Near by</label>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-floating">
                                            <textarea class="form-control" placeholder="Full description"
                                                id="fullDescription" name="full_description"
                                                style="height: 150px"></textarea>
                                            <label for="fullDescription">Full Description</label>
                                            <small class="text-muted">Detailed information about your property,
                                                features, and surroundings</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between mt-4">
                                    <button type="button" class="btn btn-secondary prev-step"
                                        data-prev="basic">Previous</button>
                                    <button type="button" class="btn btn-primary next-step" data-next="amenities">Next:
                                        Amenities</button>
                                </div>
                            </div>

                            <!-- Step 3: Amenities -->
                            <div class="tab-pane fade" id="amenities" role="tabpanel" aria-labelledby="amenities-tab">
                                <h4 class="mb-4 fw-bold">Property Amenities</h4>
                                <p class="text-muted mb-4">Select all amenities that your property offers</p>

                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <h5 class="fw-bold mb-3"><i class="fas fa-utensils text-primary me-2"></i>
                                            Kitchen</h5>
                                        <div class="amenities-checkboxes">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="kitchen"
                                                    name="amenities[]" value="kitchen">
                                                <label class="form-check-label" for="kitchen">Full kitchen</label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="microwave"
                                                    name="amenities[]" value="microwave">
                                                <label class="form-check-label" for="microwave">Microwave</label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="refrigerator"
                                                    name="amenities[]" value="refrigerator">
                                                <label class="form-check-label" for="refrigerator">Refrigerator</label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="coffeeMaker"
                                                    name="amenities[]" value="coffee_maker">
                                                <label class="form-check-label" for="coffeeMaker">Coffee maker</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <h5 class="fw-bold mb-3"><i class="fas fa-wifi text-primary me-2"></i>
                                            Technology</h5>
                                        <div class="amenities-checkboxes">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="wifi"
                                                    name="amenities[]" value="wifi" checked>
                                                <label class="form-check-label" for="wifi">WiFi</label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="tv"
                                                    name="amenities[]" value="tv">
                                                <label class="form-check-label" for="tv">TV</label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="airConditioning"
                                                    name="amenities[]" value="air_conditioning">
                                                <label class="form-check-label" for="airConditioning">Air
                                                    conditioning</label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="heating"
                                                    name="amenities[]" value="heating">
                                                <label class="form-check-label" for="heating">Heating</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <h5 class="fw-bold mb-3"><i class="fas fa-swimming-pool text-primary me-2"></i>
                                            Facilities</h5>
                                        <div class="amenities-checkboxes">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="pool"
                                                    name="amenities[]" value="pool">
                                                <label class="form-check-label" for="pool">Swimming pool</label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="gym"
                                                    name="amenities[]" value="gym">
                                                <label class="form-check-label" for="gym">Gym</label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="parking"
                                                    name="amenities[]" value="parking">
                                                <label class="form-check-label" for="parking">Free parking</label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="elevator"
                                                    name="amenities[]" value="elevator">
                                                <label class="form-check-label" for="elevator">Elevator</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <h5 class="fw-bold mb-3"><i class="fas fa-broom text-primary me-2"></i> Services
                                        </h5>
                                        <div class="amenities-checkboxes">
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="cleaning"
                                                    name="amenities[]" value="cleaning">
                                                <label class="form-check-label" for="cleaning">Cleaning service</label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="linens"
                                                    name="amenities[]" value="linens">
                                                <label class="form-check-label" for="linens">Linens provided</label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="towels"
                                                    name="amenities[]" value="towels">
                                                <label class="form-check-label" for="towels">Towels provided</label>
                                            </div>
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="checkbox" id="security"
                                                    name="amenities[]" value="security">
                                                <label class="form-check-label" for="security">24/7 Security</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <div class="form-floating">
                                            <textarea class="form-control" placeholder="Additional amenities"
                                                id="additionalAmenities" name="additional_amenities"
                                                style="height: 100px"></textarea>
                                            <label for="additionalAmenities">Additional Amenities</label>
                                            <small class="text-muted">List any other amenities not included
                                                above</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between mt-4">
                                    <button type="button" class="btn btn-secondary prev-step"
                                        data-prev="details">Previous</button>
                                    <button type="button" class="btn btn-primary next-step" data-next="photos">Next:
                                        Photos</button>
                                </div>
                            </div>

                            <!-- Step 4: Photos -->
                            <div class="tab-pane fade" id="photos" role="tabpanel" aria-labelledby="photos-tab">
                                <h4 class="mb-4 fw-bold">Property Photos</h4>
                                <p class="text-muted mb-4">Upload high-quality photos of your property. First image will
                                    be used as the main photo.</p>

                                <div class="photo-upload-container mb-4">
                                    <div class="dropzone p-5 text-center border rounded-3" id="photoDropzone">
                                        <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                        <h5>Drag & Drop Photos Here</h5>
                                        <p class="text-muted">or click to browse files</p>
                                        <input type="file" id="propertyPhotos" name="property_photos[]" multiple
                                            accept="image/*" style="display: none;">
                                        <button type="button" class="btn btn-outline-primary mt-2"
                                            id="browsePhotosBtn">Browse Files</button>
                                    </div>
                                </div>

                                <div class="photo-preview-container">
                                    <div class="row g-3" id="photoPreviewGrid">
                                        <!-- Preview images will appear here -->
                                        <div class="col-12 text-center py-4" id="noPhotosMessage">
                                            <i class="fas fa-images fa-2x text-muted mb-3"></i>
                                            <p class="text-muted">No photos uploaded yet</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-between mt-4">
                                    <button type="button" class="btn btn-secondary prev-step"
                                        data-prev="amenities">Previous</button>
                                    <button type="submit" class="btn btn-success px-4">
                                        <i class="fas fa-check-circle me-2"></i> Submit Property
                                    </button>
                                </div>
                            </div>


                        </div>
                </div>
                </form>
            </div>
        </div>
    </div>
</div>
</div>

<style>
    /* Header Styles */
    .add-property-header {
        background: linear-gradient(rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.95)),
            url('https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80');
        background-size: cover;
        background-position: center;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    /* Form Navigation Tabs */
    .nav-pills .nav-link {
        position: relative;
        padding: 1rem 1.5rem;
        color: #6c757d;
        border-radius: 0;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
    }

    .nav-pills .nav-link.active {
        color: #1e3c72;
        background-color: transparent;
        border-bottom: 3px solid #1e3c72;
        font-weight: 600;
    }

    .step-number {
        display: inline-block;
        width: 24px;
        height: 24px;
        line-height: 24px;
        text-align: center;
        background-color: #6c757d;
        color: white;
        border-radius: 50%;
        margin-right: 8px;
        font-size: 0.8rem;
    }

    .nav-pills .nav-link.active .step-number {
        background-color: #1e3c72;
    }

    /* Form Styles */
    .form-floating textarea {
        min-height: 100px;
    }

    /* Photo Upload */
    .photo-upload-container {
        position: relative;
    }

    .dropzone {
        background-color: #f8f9fa;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .dropzone:hover {
        background-color: #e9ecef;
        border-color: #dee2e6;
    }

    .dropzone.dragover {
        background-color: #e7f1ff;
        border-color: #86b7fe;
    }

    /* Photo Preview */
    .photo-preview {
        position: relative;
        border-radius: 8px;
        overflow: hidden;
        height: 150px;
    }

    .photo-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .photo-actions {
        position: absolute;
        top: 5px;
        right: 5px;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .photo-preview:hover .photo-actions {
        opacity: 1;
    }

    /* Amenities Checkboxes */
    .amenities-checkboxes {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .add-property-header {
            text-align: center;
        }

        .add-property-header .btn {
            margin-top: 15px;
            width: 100%;
        }

        .nav-pills {
            flex-wrap: nowrap;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .nav-pills .nav-link {
            white-space: nowrap;
            font-size: 0.8rem;
            padding: 0.75rem;
        }
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // Step navigation
    document.querySelectorAll('.next-step').forEach(button => {
        button.addEventListener('click', function () {
            const nextTab = document.querySelector(`#${this.dataset.next}-tab`);
            new bootstrap.Tab(nextTab).show();
            document.querySelector('.card-body').scrollIntoView({ behavior: 'smooth' });
        });
    });

    document.querySelectorAll('.prev-step').forEach(button => {
        button.addEventListener('click', function () {
            const prevTab = document.querySelector(`#${this.dataset.prev}-tab`);
            new bootstrap.Tab(prevTab).show();
            document.querySelector('.card-body').scrollIntoView({ behavior: 'smooth' });
        });
    });

    // Minimum stay toggle
    const minimumStayToggle = document.getElementById('minimumStay');
    const minimumStayFields = document.querySelector('.minimum-stay-fields');
    if (minimumStayToggle && minimumStayFields) {
        minimumStayToggle.addEventListener('change', function () {
            minimumStayFields.style.display = this.checked ? 'block' : 'none';
        });
    }

    // Photo Upload
    const dropzone = document.getElementById('photoDropzone');
    const fileInput = document.getElementById('propertyPhotos');
    const browseBtn = document.getElementById('browsePhotosBtn');
    const previewGrid = document.getElementById('photoPreviewGrid');
    const noPhotosMessage = document.getElementById('noPhotosMessage');

    // Drag & Drop prevention
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropzone.addEventListener(eventName, e => {
            e.preventDefault();
            e.stopPropagation();
        }, false);
    });

    ['dragenter', 'dragover'].forEach(event => {
        dropzone.addEventListener(event, () => dropzone.classList.add('dragover'));
    });

    ['dragleave', 'drop'].forEach(event => {
        dropzone.addEventListener(event, () => dropzone.classList.remove('dragover'));
    });

    // Handle drop
    dropzone.addEventListener('drop', function (e) {
        handleFiles(e.dataTransfer.files);
    });

    // File browse button
    browseBtn.addEventListener('click', () => fileInput.click());

    // File input
    fileInput.addEventListener('change', function () {
        handleFiles(this.files);
    });

    function handleFiles(files) {
        if (!files.length) return;

        noPhotosMessage.style.display = 'none';

        Array.from(files).forEach(file => {
            if (!file.type.startsWith('image/')) return;

            const reader = new FileReader();
            reader.onload = e => {
                const col = document.createElement('div');
                col.className = 'col-6 col-md-4 col-lg-3 mb-3';

                col.innerHTML = `
                    <div class="card shadow-sm position-relative">
                        <img src="${e.target.result}" class="card-img-top rounded" alt="Preview">
                        <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1 rounded-circle delete-photo-btn" aria-label="Delete photo">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>`;

                previewGrid.appendChild(col);

                // Delete button
                col.querySelector('.delete-photo-btn').addEventListener('click', () => {
                    col.remove();
                    if (!previewGrid.querySelector('.col-6, .col-md-4, .col-lg-3')) {
                        noPhotosMessage.style.display = 'block';
                    }
                });
            };
            reader.readAsDataURL(file);
        });
    }

    // Form validation
    const form = document.getElementById('addPropertyForm');
    if (form) {
        form.addEventListener('submit', function (e) {
            console.log('Form submitted!');
            // e.preventDefault(); // Disable for production
        });
    }

    // Animate on scroll
    const animateOnScroll = () => {
        document.querySelectorAll('.animate__animated').forEach(el => {
            const top = el.getBoundingClientRect().top;
            if (top < window.innerHeight * 0.85) {
                el.style.opacity = '1';
            }
        });
    };

    document.querySelectorAll('.animate__animated').forEach(el => el.style.opacity = '0');
    animateOnScroll();
    window.addEventListener('scroll', animateOnScroll);
});
</script>

{% endblock %}