{% extends 'user_side/index.html' %}

{% block title %}
    Booking Details
{% endblock %}

{% block content %}
    <div class="container mt-5 mb-4 d-flex justify-content-center">
        <div class="card w-75">
            <div class="card-header">
                <h5>Booking Details</h5>
            </div>
            <div class="card-body">
                <h5 class="card-title font-bold">Property : {{ booking.property.property_name if booking.property else 'Property' }}</h5>
                <p class="card-text text-primary">Check-in: {{ booking.start_date.strftime('%d %b %Y') }}</p>
                <p class="card-text text-primary">Check-out: {{ booking.end_date.strftime('%d %b %Y') }}</p>
                <p class="card-text">Status: <span class="badge bg-info text-dark">{{ booking.status }}</span></p>
                <p class="card-text">Total Price: â‚¹ {{ booking.room.price_per_night }}</p>

            </div> <hr>

        
            
            <div class="card-body">
                <h5 class="card-title font-bold">Room Type: {{ booking.room.room_type if booking.room else 'Alloted on property' }}</h5>
                <p class="card-text text-primary">Room Capacity {{ booking.room.capacity }}</p>
                <p class="card-text text-primary">Room Size: {{ booking.room.room_size }} sq ft</p>
                <p class="card-text"><strong>Bed Type :</strong> {{ booking.room.bed_type }}</span></p>
                <p class="card-text"><strong>Amenities : </strong>
                    {% if booking.room.amenities %}
                        {% for amenity in booking.room.amenities.split(',') if amenity %}
                            <span class="badge bg-secondary">{{ amenity | trim | title }}</span>
                        {% endfor %}

                    {% else %}
                        No amenities listed.
                    {% endif %}
                </p>
                <div d-flex justify-content-end align-items-center>
                    <!-- room image -->
                    {% if booking.room and booking.room.image_url %}
                        {% for photo in booking.room.image_url.split(',') %}
                            <!-- Zoomable Image -->
                            <img src="/{{ photo }}" class="img-fluid rounded mb-2 zoomable-img" alt="Room photo"
                                style="max-width: 100%; height: auto; cursor: zoom-in;" data-bs-toggle="modal" data-bs-target="#imageZoomModal">

                            <!-- Modal -->
                            <div class="modal fade" id="imageZoomModal" tabindex="-1" aria-labelledby="imageZoomLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered modal-xl">
                                    <div class="modal-content bg-transparent border-0">
                                        <div class="modal-body p-0 position-relative d-flex justify-content-center align-items-center">
                            
                                            <!-- Zoomed Image -->
                                            <img id="zoomedImage" src="" class="img-fluid w-75 rounded shadow" alt="Zoomed Photo">
                            
                                            <!-- Close Button -->
                                            <button type="button" class="btn-close position-absolute top-0 end-0 m-3"
                                                data-bs-dismiss="modal" aria-label="Close"
                                                style="z-index: 10; background-color: rgba(220, 24, 24, 0.849); padding: 1rem;">
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        {% endfor %}
                    {% else %}
                        <img src="/static/default-room.jpg" class="img-fluid rounded" alt="Default room photo" style="max-width: 100%; height: auto;">
                    {% endif %}

                </div>
            </div>
            <!-- user details -->
            <div class="card w-50 ms-4 mb-4 shadow-sm">
                <h5 class="card-title font-bold">User Details</h5>
                <p class="card-text"><strong>Name:</strong> {{ booking.user.name if booking.user else 'N/A' }}</p>
                <p class="card-text"><strong>Email:</strong> {{ booking.user.email if booking.user else 'N/A' }}</p>
                <p class="card-text"><strong>Phone:</strong> {{ booking.user.phone if booking.user else 'N/A' }}</p>
            </div>
            <div class="card-footer mb-1 d-flex justify-content-between align-items-center">
                <a href="{{ url_for('my_bookings') }}" class="btn btn-secondary btn-sm">Back to My Bookings</a>
                <!-- cancel booking -->
                {% if booking.status == 'Confirmed' %}
                    <form method="POST" action="{{ url_for('cancel_booking', booking_id=booking.id) }}" class="d-inline-block"
                        onsubmit="return confirm('Are you sure you want to cancel this booking?');">
                        <button type="submit" class="btn btn-danger btn-sm">Cancel Booking</button>
                    </form>
                {% endif %}

            </div>
        
    </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('imageZoomModal');
    const zoomedImage = document.getElementById('zoomedImage');

    document.querySelectorAll('.zoomable-img').forEach(img => {
        img.addEventListener('click', function () {
            zoomedImage.src = this.src;
        });
    });

    // Optional: Clear image on modal hide
    modal.addEventListener('hidden.bs.modal', () => {
        zoomedImage.src = '';
    });
});
</script>

    
{% endblock %}

